/*!
 * jquery oembed plugin
 *
 * Copyright (c) 2009 Richard Chamorro
 * Copyright (c) 2012 RecoVend, Inc.
 * Licensed under the MIT license
 * 
 * Author: Richard Chamorro 
 */(function(e){function r(e,t){var n=e.apiendpoint,r="",i=e.callbackparameter||"callback",s;n.indexOf("?")<=0?n+="?":n+="&",e.maxWidth!=null&&e.params["maxwidth"]==null&&(e.params.maxwidth=e.maxWidth),e.maxHeight!=null&&e.params["maxheight"]==null&&(e.params.maxheight=e.maxHeight);for(s in e.params){if(s==e.callbackparameter)continue;e.params[s]!=null&&(r+="&"+escape(s)+"="+e.params[s])}return n+="format=json&url="+escape(t)+r+"&"+i+"=?",n}function i(n,i,s){var o=r(s,i),u=e.extend({url:o,type:"get",dataType:"json",success:function(r,o,u){var a=e.extend({},r);switch(a.type){case"photo":a.code=e.fn.oembed.getPhotoCode(i,a);break;case"video":a.code=e.fn.oembed.getVideoCode(i,a);break;case"rich":a.code=e.fn.oembed.getRichCode(i,a);break;default:a.code=e.fn.oembed.getGenericCode(i,a)}a.error_code&&a.error_code==404?t.onError.call(n,i,s):!1!==t.beforeEmbed.call(n,a)&&(t.onEmbed.call(n,a),t.afterEmbed.call(n,a))},error:function(e,r,o){t.onError.call(n,i,s)}},t.ajaxOptions||{});e.ajax(u)}function s(){n=[];var r,i=[],s,u;if(!a(t.allowedProviders)){for(s=0;s<e.fn.oembed.providers.length;s++)e.inArray(e.fn.oembed.providers[s].name,t.allowedProviders)>=0&&n.push(e.fn.oembed.providers[s]);t.greedy=!1}else n=e.fn.oembed.providers;if(!a(t.disallowedProviders)){for(s=0;s<n.length;s++)e.inArray(n[s].name,t.disallowedProviders)<0&&i.push(n[s]);n=i,t.greedy=!1}a(t.customProviders)||e.each(t.customProviders,function(t,r){r instanceof e.fn.oembed.OEmbedProvider?n.push(u):(u=new e.fn.oembed.OEmbedProvider,u.fromJSON(r)&&n.push(u))}),r=o(t),t.greedy==1&&n.push(r);for(s=0;s<n.length;s++)n[s].apiendpoint==null&&(n[s].apiendpoint=r.apiendpoint)}function o(t){var n="http://oohembed.com/oohembed/";return t.defaultOEmbedProvider=="embed.ly"&&(t.embedlyKey?n="http://api.embed.ly/1/oembed?key="+t.embedlyKey+"&":n="http://api.embed.ly/1/oembed?"),new e.fn.oembed.OEmbedProvider(t.defaultOEmbedProvider,null,null,n,"callback")}function u(e){if(e==null)return null;var t,n={};for(t in e)t!=null&&(n[t.toLowerCase()]=e[t]);return n}function a(t){return typeof t=="undefined"?!0:t==null?!0:e.isArray(t)&&t.length==0?!0:!1}e.fn.oembed=function(n,r,o){return t=e.extend(!0,e.fn.oembed.defaults,r),s(),this.each(function(){var r=e(this),s=n!=null?n:r.attr("href"),a;return o?t.onEmbed=o:t.onEmbed=function(n){e.fn.oembed.insertCode(this,t.embedMethod,n)},s!=null&&(a=e.fn.oembed.getOEmbedProvider(s),a!=null?(a.params=u(t[a.name])||{},a.maxWidth=t.maxWidth,a.maxHeight=t.maxHeight,i(r,s,a)):t.onProviderNotFound.call(r,s)),r})};var t,n=[];e.fn.oembed.defaults={maxWidth:null,maxHeight:null,embedMethod:"replace",defaultOEmbedProvider:"embed.ly",embedlyKey:null,allowedProviders:null,disallowedProviders:null,customProviders:null,defaultProvider:null,greedy:!0,onProviderNotFound:function(){},beforeEmbed:function(){},afterEmbed:function(){},onEmbed:function(){},onError:function(){},ajaxOptions:{}},e.fn.oembed.insertCode=function(t,n,r){if(r==null)return;switch(n){case"auto":t.attr("href")!=null?e.fn.oembed.insertCode(t,"append",r):e.fn.oembed.insertCode(t,"replace",r);break;case"replace":t.replaceWith(r.code);break;case"fill":t.html(r.code);break;case"append":var i=t.next();if(i==null||!i.hasClass("oembed-container"))i=t.after('<div class="oembed-container"></div>').next(".oembed-container"),r!=null&&r.provider_name!=null&&i.toggleClass("oembed-container-"+r.provider_name);i.html(r.code)}},e.fn.oembed.getPhotoCode=function(e,t){var n,r=t.title?t.title:"";return r+=t.author_name?" - "+t.author_name:"",r+=t.provider_name?" - "+t.provider_name:"",n='<div><a href="'+e+"\" target='_blank'><img src=\""+t.url+'" alt="'+r+'"/></a></div>',t.html&&(n+="<div>"+t.html+"</div>"),n},e.fn.oembed.getVideoCode=function(e,t){var n=t.html;return n},e.fn.oembed.getRichCode=function(e,t){var n=t.html;return n},e.fn.oembed.getGenericCode=function(e,t){var n=t.title!=null?t.title:e,r='<a href="'+e+'">'+n+"</a>";return t.html&&(r+="<div>"+t.html+"</div>"),r},e.fn.oembed.isProviderAvailable=function(e){var t=getOEmbedProvider(e);return t!=null},e.fn.oembed.getOEmbedProvider=function(e){for(var t=0;t<n.length;t++)if(n[t].matches(e))return n[t];return null},e.fn.oembed.OEmbedProvider=function(t,n,r,i,s){function l(t){return a(t)?["."]:e.isArray(t)?t:t.split(";")}this.name=t,this.type=n,this.urlschemes=l(r),this.apiendpoint=i,this.callbackparameter=s,this.maxWidth=500,this.maxHeight=400;var o,u,f;this.matches=function(e){for(o=0;o<this.urlschemes.length;o++){f=new RegExp(this.urlschemes[o],"i");if(e.match(f)!=null)return!0}return!1},this.fromJSON=function(e){for(u in e)u!="urlschemes"?this[u]=e[u]:this[u]=l(e[u]);return!0}},e.fn.oembed.providers=[new e.fn.oembed.OEmbedProvider("youtube","video",["youtube\\.com/watch.+v=[\\w-]+&?"]),new e.fn.oembed.OEmbedProvider("flickr","photo",["flickr\\.com/photos/[-.\\w@]+/\\d+/?"],"http://flickr.com/services/oembed","jsoncallback"),new e.fn.oembed.OEmbedProvider("viddler","video",["viddler.com"]),new e.fn.oembed.OEmbedProvider("blip","video",["blip\\.tv/.+"],"http://blip.tv/oembed/"),new e.fn.oembed.OEmbedProvider("hulu","video",["hulu\\.com/watch/.*"],"http://www.hulu.com/api/oembed.json"),new e.fn.oembed.OEmbedProvider("vimeo","video",["http://www.vimeo.com/groups/.*/videos/.*","http://www.vimeo.com/.*","http://vimeo.com/groups/.*/videos/.*","http://vimeo.com/.*"],"http://vimeo.com/api/oembed.json"),new e.fn.oembed.OEmbedProvider("dailymotion","video",["dailymotion\\.com/.+"]),new e.fn.oembed.OEmbedProvider("scribd","rich",["scribd\\.com/.+"]),new e.fn.oembed.OEmbedProvider("slideshare","rich",["slideshare.net"],"http://www.slideshare.net/api/oembed/1"),new e.fn.oembed.OEmbedProvider("photobucket","photo",["photobucket\\.com/(albums|groups)/.*"],"http://photobucket.com/oembed/")]})(jQuery);